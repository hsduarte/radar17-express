<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - RADAR 17 Debate</title>
    <link href="/styles.css" rel="stylesheet">
    <!-- Replace Bootstrap icons with Heroicons or keep using Bootstrap icons with a CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>
<body class="bg-gray-100">
    <nav class="bg-gray-800 text-white shadow-md">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <a class="font-bold text-xl flex items-center" href="#">
                    <i class="bi bi-broadcast mr-2"></i> RADAR 17 - Painel Administrativo
                </a>
                <div class="hidden md:block">
                    <div class="flex space-x-4">
                        <a class="text-gray-300 hover:text-white px-3 py-2 rounded-md" href="/" target="_blank">
                            <i class="bi bi-display mr-1"></i> Ver Página de Votação
                        </a>
                        <a class="text-gray-300 hover:text-white px-3 py-2 rounded-md" href="/visualizer" target="_blank">
                            <i class="bi bi-graph-up mr-1"></i> Ver Visualização Pública
                        </a>
                    </div>
                </div>
                <button class="md:hidden text-white" id="mobile-menu-button">
                    <i class="bi bi-list text-2xl"></i>
                </button>
            </div>
            <!-- Mobile menu -->
            <div class="hidden md:hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <a class="text-gray-300 hover:text-white block px-3 py-2 rounded-md" href="/" target="_blank">
                        <i class="bi bi-display mr-1"></i> Ver Página de Votação
                    </a>
                    <a class="text-gray-300 hover:text-white block px-3 py-2 rounded-md" href="/visualizer" target="_blank">
                        <i class="bi bi-graph-up mr-1"></i> Ver Visualização Pública
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-6">
        <!-- Tabs -->
        <div class="mb-6 border-b border-gray-200">
            <ul class="flex flex-wrap -mb-px" id="myTab" role="tablist">
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-2 px-4 text-blue-600 border-b-2 border-blue-600 rounded-t-lg active" id="home-tab" data-tab-target="home-tab-pane">
                        <i class="bi bi-house-door mr-1"></i> Principal
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-2 px-4 text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg" id="questions-tab" data-tab-target="questions-tab-pane">
                        <i class="bi bi-question-circle mr-1"></i> Gestão de Questões
                    </button>
                </li>
                <li class="mr-2" role="presentation">
                    <button class="inline-block py-2 px-4 text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg" id="settings-tab" data-tab-target="settings-tab-pane">
                        <i class="bi bi-gear mr-1"></i> Configurações
                    </button>
                </li>
            </ul>
        </div>

        <div class="tab-content" id="myTabContent">
            <!-- Tab Principal -->
            <div class="tab-pane block" id="home-tab-pane" role="tabpanel">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="mb-6">
                        <div class="bg-white rounded-lg shadow-md h-full">
                            <div class="bg-blue-600 text-white px-4 py-3 rounded-t-lg">
                                <h3 class="text-xl font-bold mb-0"><i class="bi bi-trophy mr-2"></i> Pontuação Atual</h3>
                            </div>
                            <div class="p-4">
                                <div id="current-scores" class="text-4xl font-bold text-center my-4">
                                    <span class="text-blue-600">Equipa A: <span class="score">0</span></span>
                                    <span class="mx-4 px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-2xl">VS</span>
                                    <span class="text-red-600">Equipa B: <span class="score">0</span></span>
                                </div>
                                <div class="text-center mt-6">
                                    <button id="reset-scores-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">
                                        <i class="bi bi-arrow-counterclockwise mr-1"></i> Resetar Pontuações
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="bg-white rounded-lg shadow-md h-full">
                            <div class="bg-green-600 text-white px-4 py-3 rounded-t-lg">
                                <h3 class="text-xl font-bold mb-0"><i class="bi bi-chat-left-text mr-2"></i> Questão Ativa</h3>
                            </div>
                            <div class="p-4">
                                <div id="active-question-container" class="p-3 mb-3 bg-gray-100 rounded">
                                    <h4 class="mb-3 font-medium">Questão Atual:</h4>
                                    <div id="active-question-text" class="bg-gray-200 p-3 rounded text-lg">
                                        Nenhuma questão ativa
                                    </div>
                                    <div class="mt-4 flex justify-between" id="active-question-controls">
                                        <button id="start-voting-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                            <i class="bi bi-play-fill mr-1"></i> Iniciar Votação
                                        </button>
                                        <button id="end-voting-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                            <i class="bi bi-stop-fill mr-1"></i> Encerrar Votação
                                        </button>
                                    </div>
                                </div>
                                <div id="voting-status" class="bg-blue-100 text-blue-800 p-3 rounded">
                                    <i class="bi bi-info-circle mr-1"></i> Selecione uma questão para ativar.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="bg-white rounded-lg shadow-md">
                        <div class="bg-gray-700 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
                            <h3 class="text-xl font-bold mb-0"><i class="bi bi-list-check mr-2"></i> Próximas Questões</h3>
                            <button class="bg-white text-gray-800 px-3 py-1 rounded text-sm" id="refresh-preview-btn">
                                <i class="bi bi-arrow-clockwise mr-1"></i> Atualizar
                            </button>
                        </div>
                        <div class="p-4">
                            <div id="questions-preview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <!-- Serão preenchidas via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Gestão de Questões -->
            <div class="tab-pane hidden" id="questions-tab-pane" role="tabpanel">
                <div class="mb-6">
                    <div class="bg-white rounded-lg shadow-md">
                        <div class="px-4 py-3 border-b flex justify-between items-center">
                            <h3 class="text-xl font-bold mb-0"><i class="bi bi-question-circle mr-2"></i> Questões do Debate</h3>
                            <div>
                                <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded mr-2" data-modal-target="addQuestionModal">
                                    <i class="bi bi-plus-circle mr-1"></i> Adicionar Questão
                                </button>
                                <button class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded" data-modal-target="bulkUploadModal">
                                    <i class="bi bi-upload mr-1"></i> Carregar em Massa
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <div id="questions-list" class="overflow-auto max-h-[600px]">
                                <!-- Lista de questões será carregada aqui -->
                                <div class="text-center py-5">
                                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent"></div>
                                    <p class="mt-2">Carregando questões...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Configurações -->
            <div class="tab-pane hidden" id="settings-tab-pane" role="tabpanel">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="mb-6">
                        <div class="bg-white rounded-lg shadow-md">
                            <div class="bg-gray-800 text-white px-4 py-3 rounded-t-lg">
                                <h3 class="text-xl font-bold mb-0"><i class="bi bi-gear mr-2"></i> Configurações do Debate</h3>
                            </div>
                            <div class="p-4">
                                <form id="debate-settings-form">
                                    <div class="mb-4">
                                        <label for="teamA-name" class="block text-gray-700 mb-2">Nome da Equipa A</label>
                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="teamA-name" value="Nome da Equipa A">
                                    </div>
                                    <div class="mb-4">
                                        <label for="teamB-name" class="block text-gray-700 mb-2">Nome da Equipa B</label>
                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="teamB-name" value="Equipa B">
                                    </div>
                                    <div class="mb-4">
                                        <label for="debate-title" class="block text-gray-700 mb-2">Título do Debate</label>
                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="debate-title" value="RADAR 17 - Debate Participativo">
                                    </div>
                                    <div class="mb-4">
                                        <label for="debate-subtitle" class="block text-gray-700 mb-2">Subtítulo</label>
                                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="debate-subtitle" value="Jovens e Decisores Políticos">
                                    </div>
                                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Guardar Configurações</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="bg-white rounded-lg shadow-md">
                            <div class="bg-gray-800 text-white px-4 py-3 rounded-t-lg">
                                <h3 class="text-xl font-bold mb-0"><i class="bi bi-tools mr-2"></i> Ferramentas</h3>
                            </div>
                            <div class="p-4">
                                <div class="space-y-3">
                                    <button id="export-json-btn" class="w-full border border-blue-600 text-blue-600 hover:bg-blue-50 px-4 py-2 rounded">
                                        <i class="bi bi-download mr-1"></i> Exportar Questões (JSON)
                                    </button>
                                    <button id="export-csv-btn" class="w-full border border-blue-600 text-blue-600 hover:bg-blue-50 px-4 py-2 rounded">
                                        <i class="bi bi-filetype-csv mr-1"></i> Exportar Resultados (CSV)
                                    </button>
                                    <button id="clear-all-btn" class="w-full border border-red-600 text-red-600 hover:bg-red-50 px-4 py-2 rounded">
                                        <i class="bi bi-trash mr-1"></i> Limpar Todos os Dados
                                    </button>
                                </div>
                                
                                <hr class="my-4">
                                
                                <div class="bg-yellow-100 text-yellow-800 p-3 rounded mt-4">
                                    <h5 class="font-bold"><i class="bi bi-exclamation-triangle mr-1"></i> Zona de Perigo</h5>
                                    <p>As ações abaixo não podem ser desfeitas.</p>
                                </div>
                                
                                <div class="mt-3">
                                    <button id="reset-database-btn" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
                                        <i class="bi bi-database-x mr-1"></i> Resetar Base de Dados
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para adicionar questão -->
    <div id="addQuestionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4">
            <div class="bg-blue-600 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
                <h5 class="text-lg font-bold"><i class="bi bi-plus-circle mr-1"></i> Adicionar Nova Questão</h5>
                <button type="button" class="text-white hover:text-gray-200" data-modal-close>
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="add-question-form">
                    <div class="mb-4">
                        <label for="question-text" class="block text-gray-700 mb-2">Texto da Questão</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="question-text" rows="3" required></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="question-order" class="block text-gray-700 mb-2">Ordem</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="question-order" min="1" required>
                        <div class="text-sm text-gray-500 mt-1">Posição da questão na sequência do debate</div>
                    </div>
                </form>
            </div>
            <div class="px-4 py-3 bg-gray-100 rounded-b-lg flex justify-end space-x-2">
                <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded" data-modal-close>Cancelar</button>
                <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" id="save-question-btn">Guardar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para editar questão -->
    <div id="editQuestionModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4">
            <div class="bg-yellow-500 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
                <h5 class="text-lg font-bold"><i class="bi bi-pencil-square mr-1"></i> Editar Questão</h5>
                <button type="button" class="text-white hover:text-gray-200" data-modal-close>
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="edit-question-form">
                    <input type="hidden" id="edit-question-id">
                    <div class="mb-4">
                        <label for="edit-question-text" class="block text-gray-700 mb-2">Texto da Questão</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="edit-question-text" rows="3" required></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="edit-question-order" class="block text-gray-700 mb-2">Ordem</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="edit-question-order" min="1" required>
                    </div>
                </form>
            </div>
            <div class="px-4 py-3 bg-gray-100 rounded-b-lg flex justify-end space-x-2">
                <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded" data-modal-close>Cancelar</button>
                <button type="button" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded" id="update-question-btn">Atualizar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para carregamento em massa -->
    <div id="bulkUploadModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-2xl w-full mx-4">
            <div class="bg-gray-700 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
                <h5 class="text-lg font-bold"><i class="bi bi-upload mr-1"></i> Carregar Múltiplas Questões</h5>
                <button type="button" class="text-white hover:text-gray-200" data-modal-close>
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="p-4">
                <form id="bulk-upload-form">
                    <div class="mb-4">
                        <label for="bulk-questions" class="block text-gray-700 mb-2">Questões (uma por linha)</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" id="bulk-questions" rows="10" required 
                            placeholder="Como podemos melhorar o transporte público na cidade?
Quais são as maiores barreiras ao acesso à habitação para jovens?
Como aumentar a participação juvenil nas decisões políticas?"></textarea>
                        <div class="text-sm text-gray-500 mt-1">Cada linha representa uma questão. As questões serão numeradas automaticamente, começando da ordem mais alta existente.</div>
                    </div>
                </form>
            </div>
            <div class="px-4 py-3 bg-gray-100 rounded-b-lg flex justify-end space-x-2">
                <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded" data-modal-close>Cancelar</button>
                <button type="button" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded" id="upload-bulk-btn">Carregar</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação -->
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4">
            <div class="bg-red-600 text-white px-4 py-3 rounded-t-lg flex justify-between items-center">
                <h5 class="text-lg font-bold"><i class="bi bi-exclamation-triangle mr-1"></i> Confirmação</h5>
                <button type="button" class="text-white hover:text-gray-200" data-modal-close>
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="p-4">
                <p id="confirmation-message">Tem certeza que deseja realizar esta ação?</p>
            </div>
            <div class="px-4 py-3 bg-gray-100 rounded-b-lg flex justify-end space-x-2">
                <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded" data-modal-close>Cancelar</button>
                <button type="button" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded" id="confirm-action-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white mt-8 py-4">
        <div class="container mx-auto text-center">
            <p class="mb-0">RADAR 17 - Sistema de Debate Participativo © 2025</p>
        </div>
    </footer>

    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script src="/js/toast.js"></script>
    <script src="admin.js"></script>
</body>
</html>